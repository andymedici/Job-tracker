# nixpacks.toml

# Use the latest Python environment
[phases.setup]
nixPkgs = [
  "python312",
  "python312Packages.pip",
  "git"  # sometimes needed
]

# Install required system libraries for Playwright/Chromium
# These are the essential Debian/Ubuntu packages Playwright needs to run headless
[phases.install]
aptPkgs = [
  "libnss3",
  "libnspr4",
  "libatk1.0-0",
  "libatk-bridge2.0-0",
  "libcups2",
  "libdrm2",
  "libxkbcommon0",
  "libxcomposite1",
  "libxdamage1",
  "libxfixes3",
  "libxrandr2",
  "libgbm1",
  "libpango-1.0-0",
  "libcairo2",
  "libasound2",
  "libatspi2.0-0",
  "libwayland-server0",
  "libgtk-3-0",
  "libgdk-pixbuf2.0-0",
  "fonts-liberation",
  "libappindicator3-1",
  "libdbus-1-3",
  "libxshmfence1",
  "ca-certificates"
]

# Optional: Cache Playwright browsers to speed up future builds
# (Railway doesn't persist cache across deploys perfectly, but it helps during build)
[phases.build]
cmds = [
  "pip install --no-cache-dir -r requirements.txt",
  "playwright install chromium --with-deps"  # Installs Chromium + deps (safe to run again)
]

# Start command (Railway will override if you have railway.json, but safe to include)
[start]
cmd = "python app.py"
